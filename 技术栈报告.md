# SQLå­¦ä¹ å¹³å°æŠ€æœ¯æ ˆæŠ¥å‘Š

**é¡¹ç›®åç§°**ï¼šSQLè¯­è¨€å­¦ä¹ å¹³å°  
**å¼€å‘å›¢é˜Ÿ**ï¼šå“ˆå°”æ»¨å‰‘æ¡¥å­¦é™¢  
**ç‰ˆæœ¬**ï¼š1.0.0  

---

## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„è®¾è®¡](#2-ç³»ç»Ÿæ¶æ„è®¾è®¡)
3. [æŠ€æœ¯æ ˆè¯¦è§£](#3-æŠ€æœ¯æ ˆè¯¦è§£)
4. [åç«¯æŠ€æœ¯å®ç°](#4-åç«¯æŠ€æœ¯å®ç°)
5. [å‰ç«¯æŠ€æœ¯å®ç°](#5-å‰ç«¯æŠ€æœ¯å®ç°)
6. [æ•°æ®åº“è®¾è®¡](#6-æ•°æ®åº“è®¾è®¡)
7. [AIæ™ºèƒ½åŠŸèƒ½å®ç°](#7-aiæ™ºèƒ½åŠŸèƒ½å®ç°)
8. [å®‰å…¨æœºåˆ¶](#8-å®‰å…¨æœºåˆ¶)
9. [éƒ¨ç½²æ¶æ„](#9-éƒ¨ç½²æ¶æ„)
10. [æ ¸å¿ƒåŠŸèƒ½å®ç°åŸç†](#10-æ ¸å¿ƒåŠŸèƒ½å®ç°åŸç†)
11. [æŠ€æœ¯äº®ç‚¹ä¸åˆ›æ–°](#11-æŠ€æœ¯äº®ç‚¹ä¸åˆ›æ–°)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªé¢å‘æ•°æ®åº“è¯¾ç¨‹æ•™å­¦çš„ **SQLè¯­è¨€å­¦ä¹ å¹³å°**ï¼Œæ—¨åœ¨ä¸ºå­¦ç”Ÿæä¾›ä¸€ä¸ªäº¤äº’å¼çš„SQLå­¦ä¹ ç¯å¢ƒã€‚å¹³å°é›†æˆäº†ç”¨æˆ·ç®¡ç†ã€åœ¨çº¿SQLç»ƒä¹ ã€AIæ™ºèƒ½è¾…å¯¼ã€ç¤¾åŒºäº¤æµç­‰åŠŸèƒ½ï¼Œå®ç°äº†"å­¦ã€ç»ƒã€é—®ã€è¯„"ä¸€ä½“åŒ–çš„å­¦ä¹ ä½“éªŒã€‚

### 1.2 æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

| åŠŸèƒ½æ¨¡å— | æè¿° |
|---------|------|
| ç”¨æˆ·è®¤è¯ç³»ç»Ÿ | æ³¨å†Œã€ç™»å½•ã€JWTä»¤ç‰ŒéªŒè¯ |
| SQLä¾‹é¢˜ç»ƒä¹  | åŸºäºçœŸå®æ•°æ®åº“çš„SQLç»ƒä¹ ä¸è‡ªåŠ¨è¯„åˆ¤ |
| AIæ™ºèƒ½è¾…å¯¼ | ä»£ç åˆ†æã€é”™è¯¯å¼•å¯¼ã€ç­”æ¡ˆè¯„ä»· |
| çŸ¥è¯†åº“ç³»ç»Ÿ | SQLçŸ¥è¯†ç‚¹å­¦ä¹ ä¸è¿›åº¦è¿½è¸ª |
| ç¤¾åŒºè¯„è®º | ç”¨æˆ·äº¤æµã€é—®ç­”ã€AIè‡ªåŠ¨å›å¤ |
| SQLç»ƒä¹ åœº | è‡ªç”±æ‰§è¡ŒSQLè¯­å¥çš„æ²™ç®±ç¯å¢ƒ |

### 1.3 æŠ€æœ¯æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®¢æˆ·ç«¯ (æµè§ˆå™¨)                           â”‚
â”‚                    Vue 3 + Vite + Pinia                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ HTTPS
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     åç«¯æœåŠ¡ (Node.js)                           â”‚
â”‚                 Express + RESTful API                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  è®¤è¯    â”‚  è¯„è®º    â”‚  çŸ¥è¯†åº“   â”‚  ä¾‹é¢˜    â”‚   AI     â”‚      â”‚
â”‚  â”‚  æ¨¡å—    â”‚  æ¨¡å—    â”‚  æ¨¡å—    â”‚  æ¨¡å—    â”‚  æœåŠ¡    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚          â”‚          â”‚          â”‚          â”‚
        â–¼          â–¼          â–¼          â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   NeonDB PostgreSQL   â”‚              â”‚    é˜¿é‡Œäº‘é€šä¹‰åƒé—® API   â”‚
â”‚     äº‘æ•°æ®åº“          â”‚              â”‚   (qwen3-coder-plus)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ç³»ç»Ÿæ¶æ„è®¾è®¡

### 2.1 å‰åç«¯åˆ†ç¦»æ¶æ„

æœ¬é¡¹ç›®é‡‡ç”¨ **å‰åç«¯åˆ†ç¦»** çš„ç°ä»£Webå¼€å‘æ¶æ„ï¼š

- **å‰ç«¯**ï¼šVue 3 å•é¡µåº”ç”¨ (SPA)ï¼Œé€šè¿‡ Axios ä¸åç«¯ API é€šä¿¡
- **åç«¯**ï¼šNode.js + Express æ„å»ºçš„ RESTful API æœåŠ¡
- **æ•°æ®åº“**ï¼šPostgreSQL äº‘æ•°æ®åº“ (NeonDB)
- **AIæœåŠ¡**ï¼šé˜¿é‡Œäº‘é€šä¹‰åƒé—®å¤§æ¨¡å‹ API

### 2.2 MVC è®¾è®¡æ¨¡å¼

åç«¯é‡‡ç”¨ç»å…¸çš„ **MVC (Model-View-Controller)** è®¾è®¡æ¨¡å¼ï¼š

```
backend/src/
â”œâ”€â”€ config/          # é…ç½®å±‚ - ç¯å¢ƒå˜é‡ã€æ•°æ®åº“é…ç½®
â”œâ”€â”€ models/          # Modelå±‚ - æ•°æ®æ¨¡å‹ä¸æ•°æ®åº“æ“ä½œ
â”œâ”€â”€ controllers/     # Controllerå±‚ - ä¸šåŠ¡é€»è¾‘å¤„ç†
â”œâ”€â”€ routes/          # è·¯ç”±å±‚ - APIè·¯ç”±å®šä¹‰
â”œâ”€â”€ middleware/      # ä¸­é—´ä»¶ - è®¤è¯ã€éªŒè¯ã€æ—¥å¿—
â”œâ”€â”€ services/        # æœåŠ¡å±‚ - AIæœåŠ¡ã€ç¬¬ä¸‰æ–¹é›†æˆ
â””â”€â”€ scripts/         # è„šæœ¬ - æ•°æ®åº“åˆå§‹åŒ–
```

### 2.3 ç»„ä»¶åŒ–å‰ç«¯æ¶æ„

å‰ç«¯é‡‡ç”¨ Vue 3 çš„ **Composition API** å’Œç»„ä»¶åŒ–æ¶æ„ï¼š

```
frontend/src/
â”œâ”€â”€ views/           # é¡µé¢çº§ç»„ä»¶
â”œâ”€â”€ components/      # å¯å¤ç”¨ç»„ä»¶
â”œâ”€â”€ stores/          # PiniaçŠ¶æ€ç®¡ç†
â”œâ”€â”€ services/        # APIæœåŠ¡å°è£…
â”œâ”€â”€ router/          # è·¯ç”±é…ç½®
â””â”€â”€ assets/          # é™æ€èµ„æº
```

---

## 3. æŠ€æœ¯æ ˆè¯¦è§£

### 3.1 åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯/æ¡†æ¶ | ç‰ˆæœ¬ | ç”¨é€” |
|-----------|------|------|
| **Node.js** | v18+ | JavaScriptè¿è¡Œæ—¶ç¯å¢ƒ |
| **Express** | 4.18.2 | Webåº”ç”¨æ¡†æ¶ï¼Œå¤„ç†HTTPè¯·æ±‚ |
| **PostgreSQL** | 15+ | å…³ç³»å‹æ•°æ®åº“ |
| **pg** | 8.11.3 | PostgreSQL Node.jsé©±åŠ¨ |
| **jsonwebtoken** | 9.0.2 | JWTä»¤ç‰Œç”Ÿæˆä¸éªŒè¯ |
| **bcryptjs** | 2.4.3 | å¯†ç åŠ å¯† |
| **express-validator** | 7.0.1 | è¯·æ±‚å‚æ•°éªŒè¯ |
| **helmet** | 7.1.0 | HTTPå®‰å…¨å¤´è®¾ç½® |
| **cors** | 2.8.5 | è·¨åŸŸèµ„æºå…±äº« |
| **express-rate-limit** | 7.1.5 | APIè¯·æ±‚é¢‘ç‡é™åˆ¶ |
| **uuid** | 9.0.1 | UUIDç”Ÿæˆ |
| **dotenv** | 16.3.1 | ç¯å¢ƒå˜é‡ç®¡ç† |
| **nodemon** | 3.0.2 | å¼€å‘çƒ­é‡è½½ |

### 3.2 å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯/æ¡†æ¶ | ç‰ˆæœ¬ | ç”¨é€” |
|-----------|------|------|
| **Vue.js** | 3.4.0 | æ¸è¿›å¼JavaScriptæ¡†æ¶ |
| **Vite** | 5.0.8 | æ–°ä¸€ä»£å‰ç«¯æ„å»ºå·¥å…· |
| **Vue Router** | 4.2.5 | å®˜æ–¹è·¯ç”±ç®¡ç†å™¨ |
| **Pinia** | 2.1.7 | Vue 3çŠ¶æ€ç®¡ç†åº“ |
| **Axios** | 1.6.2 | HTTPå®¢æˆ·ç«¯ |
| **marked** | 11.1.0 | Markdownè§£æå™¨ |
| **highlight.js** | 11.9.0 | ä»£ç è¯­æ³•é«˜äº® |
| **dayjs** | 1.11.10 | æ—¥æœŸæ—¶é—´å¤„ç† |

### 3.3 äº‘æœåŠ¡ä¸éƒ¨ç½²

| æœåŠ¡ | æä¾›å•† | ç”¨é€” |
|------|--------|------|
| **æ•°æ®åº“** | NeonDB | PostgreSQLäº‘æ•°æ®åº“ |
| **AIæ¨¡å‹** | é˜¿é‡Œäº‘ | é€šä¹‰åƒé—®å¤§æ¨¡å‹API |
| **å‰ç«¯éƒ¨ç½²** | Netlify/Vercel | é™æ€ç½‘ç«™æ‰˜ç®¡ |
| **åç«¯éƒ¨ç½²** | Render | Node.jsæœåŠ¡æ‰˜ç®¡ |
| **å†…ç½‘ç©¿é€** | ngrok | æœ¬åœ°å¼€å‘å¤–ç½‘è®¿é—® |

---

## 4. åç«¯æŠ€æœ¯å®ç°

### 4.1 Expressåº”ç”¨æ¶æ„

Expressåº”ç”¨çš„æ ¸å¿ƒé…ç½®ï¼ˆ`app.js`ï¼‰ï¼š

```javascript
const express = require('express');
const cors = require('cors');
const helmet = require('helmet');
const rateLimit = require('express-rate-limit');

const app = express();

// å®‰å…¨ä¸­é—´ä»¶
app.use(helmet({
  crossOriginResourcePolicy: { policy: "cross-origin" }
}));

// CORSé…ç½® - å…è®¸è·¨åŸŸè¯·æ±‚
app.use(cors({
  origin: true,
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization']
}));

// è¯·æ±‚ä½“è§£æ
app.use(express.json({ limit: '10mb' }));

// APIè·¯ç”±æ³¨å†Œ
app.use('/api/auth', authRoutes);
app.use('/api/exercises', exerciseRoutes);
app.use('/api/comments', commentRoutes);
app.use('/api/knowledge', knowledgeRoutes);
app.use('/api/ai', aiRoutes);
```

### 4.2 æ•°æ®åº“è¿æ¥æ± 

ä½¿ç”¨ `pg` æ¨¡å—åˆ›å»º PostgreSQL è¿æ¥æ± ï¼Œå®ç°é«˜æ•ˆçš„æ•°æ®åº“è®¿é—®ï¼š

```javascript
const { Pool } = require('pg');

const dbConfig = {
  connectionString: process.env.DATABASE_URL,
  ssl: { rejectUnauthorized: false },
  max: 20,                    // æœ€å¤§è¿æ¥æ•°
  idleTimeoutMillis: 30000,   // ç©ºé—²è¶…æ—¶
  connectionTimeoutMillis: 10000  // è¿æ¥è¶…æ—¶
};

const pool = new Pool(dbConfig);

// å°è£…æŸ¥è¯¢æ–¹æ³•
const query = async (text, params) => {
  const start = Date.now();
  const result = await pool.query(text, params);
  const duration = Date.now() - start;
  console.log(`ğŸ“Š æŸ¥è¯¢æ‰§è¡Œ: ${duration}ms, è¡Œæ•°: ${result.rowCount}`);
  return result;
};
```

**æŠ€æœ¯è¦ç‚¹**ï¼š
- ä½¿ç”¨è¿æ¥æ± é¿å…é¢‘ç¹åˆ›å»º/é”€æ¯è¿æ¥
- SSLåŠ å¯†ä¿è¯æ•°æ®ä¼ è¾“å®‰å…¨
- æŸ¥è¯¢æ—¥å¿—ä¾¿äºæ€§èƒ½ç›‘æ§

### 4.3 RESTful APIè®¾è®¡

APIéµå¾ª RESTful è®¾è®¡è§„èŒƒï¼š

| HTTPæ–¹æ³• | è·¯å¾„ | æè¿° |
|---------|------|------|
| POST | `/api/auth/register` | ç”¨æˆ·æ³¨å†Œ |
| POST | `/api/auth/login` | ç”¨æˆ·ç™»å½• |
| GET | `/api/exercises` | è·å–ä¾‹é¢˜åˆ—è¡¨ |
| POST | `/api/exercises/:id/submit` | æäº¤ç­”æ¡ˆ |
| POST | `/api/exercises/execute` | æ‰§è¡ŒSQL |
| POST | `/api/ai/analyze` | AIä»£ç åˆ†æ |

**å“åº”æ ¼å¼ç»Ÿä¸€è§„èŒƒ**ï¼š

```javascript
// æˆåŠŸå“åº”
{
  "success": true,
  "data": { ... },
  "message": "æ“ä½œæˆåŠŸ"
}

// é”™è¯¯å“åº”
{
  "success": false,
  "message": "é”™è¯¯æè¿°"
}
```

### 4.4 ä¸­é—´ä»¶æœºåˆ¶

#### 4.4.1 JWTè®¤è¯ä¸­é—´ä»¶

```javascript
const authenticateToken = async (req, res, next) => {
  const authHeader = req.headers.authorization;
  const token = authHeader && authHeader.split(' ')[1]; // Bearer TOKEN

  if (!token) {
    return res.status(401).json({
      success: false,
      message: 'æœªæä¾›è®¤è¯ä»¤ç‰Œ'
    });
  }

  try {
    const decoded = jwt.verify(token, config.jwtSecret);
    const user = await User.findById(decoded.userId);
    req.user = user;
    next();
  } catch (error) {
    if (error.name === 'TokenExpiredError') {
      return res.status(401).json({ message: 'ä»¤ç‰Œå·²è¿‡æœŸ' });
    }
    return res.status(401).json({ message: 'æ— æ•ˆçš„è®¤è¯ä»¤ç‰Œ' });
  }
};
```

#### 4.4.2 è¯·æ±‚é¢‘ç‡é™åˆ¶

```javascript
const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15åˆ†é’Ÿçª—å£
  max: 100,                  // æœ€å¤š100æ¬¡è¯·æ±‚
  message: {
    success: false,
    message: 'è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•'
  }
});

// AIè·¯ç”±ç‰¹æ®Šé™åˆ¶ï¼ˆæ›´ä¸¥æ ¼ï¼‰
const aiLimiter = rateLimit({
  windowMs: 60 * 1000,  // 1åˆ†é’Ÿçª—å£
  max: 10               // æœ€å¤š10æ¬¡è¯·æ±‚
});
```

---

## 5. å‰ç«¯æŠ€æœ¯å®ç°

### 5.1 Vue 3 Composition API

æœ¬é¡¹ç›®å…¨é¢é‡‡ç”¨ Vue 3 çš„ **Composition API**ï¼Œç›¸æ¯” Options API å…·æœ‰æ›´å¥½çš„ä»£ç ç»„ç»‡å’Œç±»å‹æ¨æ–­ï¼š

```javascript
<script setup>
import { ref, onMounted, computed } from 'vue'
import { exerciseAPI } from '@/services/api'
import { useAuthStore } from '@/stores/auth'

// å“åº”å¼çŠ¶æ€
const exercises = ref([])
const loading = ref(true)
const selectedExercise = ref(null)

// è®¡ç®—å±æ€§
const completedCount = computed(() => 
  exercises.value.filter(e => e.is_correct).length
)

// ç”Ÿå‘½å‘¨æœŸé’©å­
onMounted(async () => {
  loading.value = true
  const response = await exerciseAPI.getAll()
  exercises.value = response.data.data.exercises
  loading.value = false
})
</script>
```

### 5.2 PiniaçŠ¶æ€ç®¡ç†

Pinia æ˜¯ Vue 3 å®˜æ–¹æ¨èçš„çŠ¶æ€ç®¡ç†åº“ï¼Œæ›¿ä»£äº† Vuexï¼š

```javascript
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'
import api from '@/services/api'

export const useAuthStore = defineStore('auth', () => {
  // çŠ¶æ€
  const user = ref(null)
  const token = ref(localStorage.getItem('token') || null)

  // è®¡ç®—å±æ€§
  const isLoggedIn = computed(() => !!token.value && !!user.value)

  // ç™»å½•æ–¹æ³•
  const login = async (credentials) => {
    const response = await api.post('/auth/login', credentials)
    if (response.data.success) {
      user.value = response.data.data.user
      setToken(response.data.data.token)
      return { success: true }
    }
    return { success: false, message: response.data.message }
  }

  return { user, token, isLoggedIn, login }
})
```

**Piniaçš„ä¼˜åŠ¿**ï¼š
- æ›´ç®€æ´çš„APIè®¾è®¡
- å®Œæ•´çš„TypeScriptæ”¯æŒ
- æ”¯æŒComposition APIé£æ ¼
- å¼€å‘è€…å·¥å…·é›†æˆ

### 5.3 Vue Routerè·¯ç”±é…ç½®

```javascript
import { createRouter, createWebHistory } from 'vue-router'

// è·¯ç”±æ‡’åŠ è½½ - æŒ‰éœ€åŠ è½½ç»„ä»¶
const Exercises = () => import('@/views/Exercises.vue')
const Knowledge = () => import('@/views/Knowledge.vue')

const routes = [
  {
    path: '/exercises',
    name: 'Exercises',
    component: Exercises,
    meta: { title: 'ä¾‹é¢˜ç»ƒä¹ ' }
  },
  {
    path: '/profile',
    name: 'Profile',
    component: Profile,
    meta: { title: 'ä¸ªäººä¸­å¿ƒ', requiresAuth: true }  // éœ€è¦ç™»å½•
  }
]

// è·¯ç”±å®ˆå« - æƒé™æ§åˆ¶
router.beforeEach(async (to, from, next) => {
  const authStore = useAuthStore()
  
  if (to.meta.requiresAuth && !authStore.isLoggedIn) {
    next({ name: 'Login', query: { redirect: to.fullPath } })
  } else {
    next()
  }
})
```

### 5.4 Axiosè¯·æ±‚å°è£…

```javascript
import axios from 'axios'

// åˆ›å»ºaxioså®ä¾‹
const api = axios.create({
  baseURL: '/api',
  timeout: 30000,
  headers: { 'Content-Type': 'application/json' }
})

// è¯·æ±‚æ‹¦æˆªå™¨ - è‡ªåŠ¨æ·»åŠ Token
api.interceptors.request.use(
  config => {
    const token = localStorage.getItem('token')
    if (token) {
      config.headers.Authorization = `Bearer ${token}`
    }
    return config
  },
  error => Promise.reject(error)
)

// å“åº”æ‹¦æˆªå™¨ - ç»Ÿä¸€é”™è¯¯å¤„ç†
api.interceptors.response.use(
  response => response,
  error => {
    if (error.response?.status === 401) {
      // Tokenè¿‡æœŸï¼Œæ¸…é™¤ç™»å½•çŠ¶æ€
      localStorage.removeItem('token')
      window.location.href = '/login'
    }
    return Promise.reject(error)
  }
)
```

### 5.5 åŠ¨æ€èƒŒæ™¯CanvasåŠ¨ç”»

ä½¿ç”¨ HTML5 Canvas å®ç°ç²’å­åŠ¨ç”»æ•ˆæœï¼š

```javascript
class Particle {
  constructor() {
    this.x = Math.random() * width
    this.y = Math.random() * height
    this.size = Math.random() * 1.5 + 0.2
    this.speedX = Math.random() * 0.4 - 0.2
    this.speedY = Math.random() * 0.5 + 0.1
    this.opacity = Math.random() * 0.6 + 0.1
    this.color = `rgba(255, 215, 0, ${this.opacity})`  // é‡‘è‰²ç²’å­
  }

  update() {
    this.x += this.speedX
    this.y += this.speedY
    this.x += Math.sin(this.y * 0.01) * 0.1  // æ­£å¼¦æ‘†åŠ¨æ•ˆæœ
  }

  draw() {
    ctx.beginPath()
    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2)
    ctx.fillStyle = this.color
    ctx.fill()
  }
}

// åŠ¨ç”»å¾ªç¯
const animate = () => {
  ctx.clearRect(0, 0, width, height)
  particles.forEach(p => {
    p.update()
    p.draw()
  })
  requestAnimationFrame(animate)
}
```

---

## 6. æ•°æ®åº“è®¾è®¡

### 6.1 ç”¨æˆ·ç³»ç»Ÿè¡¨

```sql
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  uuid VARCHAR(36) UNIQUE NOT NULL,
  username VARCHAR(50) UNIQUE NOT NULL,
  email VARCHAR(100) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  avatar_url VARCHAR(255),
  role VARCHAR(20) DEFAULT 'user',      -- user/admin/moderator
  is_active BOOLEAN DEFAULT true,
  last_login TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 6.2 ä¾‹é¢˜ç³»ç»Ÿè¡¨

```sql
-- ä¾‹é¢˜è¡¨
CREATE TABLE exercises (
  id SERIAL PRIMARY KEY,
  title VARCHAR(200) NOT NULL,
  description TEXT NOT NULL,
  difficulty VARCHAR(20) DEFAULT 'beginner',  -- beginner/intermediate/advanced
  category VARCHAR(50),
  hint TEXT,
  correct_sql TEXT NOT NULL,
  expected_result_description TEXT,
  order_index INT DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- å­¦ç”Ÿç­”é¢˜è®°å½•è¡¨
CREATE TABLE exercise_submissions (
  id SERIAL PRIMARY KEY,
  user_id INT REFERENCES users(id),
  exercise_id INT REFERENCES exercises(id),
  user_sql TEXT NOT NULL,
  is_correct BOOLEAN DEFAULT FALSE,
  ai_feedback TEXT,
  attempt_count INT DEFAULT 1,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 6.3 ç»ƒä¹ æ•°æ®åº“è¡¨

```sql
-- å­¦ç”Ÿè¡¨ (æ•™å­¦ç”¨)
CREATE TABLE practice_student (
  Sno CHAR(10) PRIMARY KEY,
  Sname CHAR(20) UNIQUE,
  Ssex CHAR(2),
  Sage INT,
  Sdept CHAR(20)
);

-- è¯¾ç¨‹è¡¨ (æ•™å­¦ç”¨)
CREATE TABLE practice_course (
  Cno CHAR(4) PRIMARY KEY,
  Cname CHAR(40) NOT NULL,
  Cpno CHAR(4),
  Ccredit SMALLINT
);

-- é€‰è¯¾æˆç»©è¡¨ (æ•™å­¦ç”¨)
CREATE TABLE practice_sc (
  Sno CHAR(10),
  Cno CHAR(4),
  Grade INT,
  PRIMARY KEY (Sno, Cno)
);
```

### 6.4 è¯„è®ºç³»ç»Ÿè¡¨

```sql
CREATE TABLE comments (
  id SERIAL PRIMARY KEY,
  user_id INT REFERENCES users(id),
  parent_id INT REFERENCES comments(id),  -- å›å¤å…³è”
  content TEXT NOT NULL,
  code_snippet TEXT,                       -- SQLä»£ç ç‰‡æ®µ
  is_ai_reply BOOLEAN DEFAULT false,       -- AIå›å¤æ ‡è¯†
  likes_count INT DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 6.5 ERå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   users     â”‚       â”‚     comments        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)     â”‚â—„â”€â”€â”€â”€â”€â”€â”‚ user_id (FK)        â”‚
â”‚ username    â”‚       â”‚ parent_id (FK)      â”‚â”€â”€â”
â”‚ email       â”‚       â”‚ content             â”‚  â”‚
â”‚ password    â”‚       â”‚ code_snippet        â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â—„â”€â”˜
      â”‚
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ exercise_submissionsâ”‚       â”‚   exercises     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ user_id (FK)        â”‚       â”‚ id (PK)         â”‚
â”‚ exercise_id (FK)    â”‚â”€â”€â”€â”€â”€â”€â–ºâ”‚ title           â”‚
â”‚ user_sql            â”‚       â”‚ correct_sql     â”‚
â”‚ is_correct          â”‚       â”‚ difficulty      â”‚
â”‚ ai_feedback         â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. AIæ™ºèƒ½åŠŸèƒ½å®ç°

### 7.1 AIæœåŠ¡æ¶æ„

æœ¬é¡¹ç›®é›†æˆäº†**é˜¿é‡Œäº‘é€šä¹‰åƒé—®å¤§æ¨¡å‹**ï¼Œé‡‡ç”¨åŒæ¨¡å‹ç­–ç•¥ï¼š

| æ¨¡å‹ | ç”¨é€” | ç‰¹ç‚¹ |
|------|------|------|
| `qwen3-coder-plus` | SQLä»£ç åˆ†æã€çº é”™ã€ä¾‹é¢˜è¯„åˆ¤ | ä»£ç ç†è§£èƒ½åŠ›å¼º |
| `qwen-max` | é€šç”¨å¯¹è¯ã€æç¤ºç”Ÿæˆã€çŸ¥è¯†é—®ç­” | å¯¹è¯æµç•…è‡ªç„¶ |

### 7.2 AIæœåŠ¡ç±»å®ç°

```javascript
class AIService {
  constructor() {
    this.apiKey = config.qwenApiKey;
    this.apiUrl = config.qwenApiUrl;
    this.coderModel = 'qwen3-coder-plus';  // ä»£ç æ¨¡å‹
    this.maxModel = 'qwen-max';            // å¯¹è¯æ¨¡å‹
  }

  async callQwenAPI(messages, maxTokens = 2000, modelType = 'default') {
    let model;
    switch (modelType) {
      case 'coder': model = this.coderModel; break;
      case 'max': model = this.maxModel; break;
      default: model = this.defaultModel;
    }

    const response = await fetch(this.apiUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${this.apiKey}`
      },
      body: JSON.stringify({
        model: model,
        messages: messages,
        max_tokens: maxTokens,
        temperature: 0.7
      })
    });

    const data = await response.json();
    return data.choices[0].message.content;
  }
}
```

### 7.3 AIåŠŸèƒ½åº”ç”¨åœºæ™¯

#### 7.3.1 SQLä»£ç åˆ†æ

```javascript
async analyzeSQLCode(sqlCode) {
  const messages = [
    {
      role: 'system',
      content: `ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„SQLæ•™å¸ˆå’Œä»£ç è¯„å®¡ä¸“å®¶ã€‚è¯·åˆ†æç”¨æˆ·æä¾›çš„SQLä»£ç ï¼ŒæŒ‡å‡ºï¼š
1. ä»£ç çš„æ­£ç¡®æ€§å’Œå¯èƒ½çš„é”™è¯¯
2. ä»£ç é£æ ¼å’Œæœ€ä½³å®è·µå»ºè®®
3. æ€§èƒ½ä¼˜åŒ–å»ºè®®
4. å¸¸è§æ˜“é”™ç‚¹æé†’`
    },
    {
      role: 'user',
      content: `è¯·åˆ†æä»¥ä¸‹SQLä»£ç ï¼š\n\`\`\`sql\n${sqlCode}\n\`\`\``
    }
  ];

  return this.callQwenAPI(messages, 2000, 'coder');
}
```

#### 7.3.2 ä¾‹é¢˜ç­”æ¡ˆè¯„åˆ¤ä¸å¼•å¯¼

```javascript
async analyzeExerciseAnswer(exerciseDescription, hint, userSQL, userResult, correctSQL) {
  const messages = [
    {
      role: 'system',
      content: `ä½ æ˜¯ä¸€ä½è€å¿ƒçš„SQLæ•™å¸ˆï¼Œæ­£åœ¨å¸®åŠ©å­¦ç”Ÿç»ƒä¹ SQLæŸ¥è¯¢ã€‚å­¦ç”Ÿçš„ç­”æ¡ˆä¸æ­£ç¡®ï¼Œä½ éœ€è¦ï¼š
1. åˆ†æé”™è¯¯åŸå› ï¼šæŒ‡å‡ºå­¦ç”ŸSQLè¯­å¥ä¸­çš„å…·ä½“é—®é¢˜
2. å¼•å¯¼æ€è€ƒï¼šä¸è¦ç›´æ¥ç»™å‡ºæ­£ç¡®ç­”æ¡ˆï¼Œè€Œæ˜¯é€šè¿‡æé—®æˆ–æç¤ºå¼•å¯¼å­¦ç”Ÿæ€è€ƒ
3. ç»™å‡ºå»ºè®®ï¼šæä¾›ä¿®æ”¹æ–¹å‘ï¼Œä½†è®©å­¦ç”Ÿè‡ªå·±å°è¯•ä¿®æ­£
4. é¼“åŠ±å­¦ç”Ÿï¼šç”¨å‹å¥½çš„è¯­æ°”é¼“åŠ±å­¦ç”Ÿç»§ç»­å°è¯•

æ³¨æ„ï¼šä¸è¦ç›´æ¥å±•ç¤ºæ­£ç¡®çš„SQLè¯­å¥ï¼Œç”¨å¾ªåºæ¸è¿›çš„æ–¹å¼å¼•å¯¼ã€‚`
    },
    {
      role: 'user',
      content: `**é¢˜ç›®è¦æ±‚**ï¼š${exerciseDescription}
**é¢˜ç›®æç¤º**ï¼š${hint}
**å­¦ç”Ÿçš„SQLè¯­å¥**ï¼š${userSQL}
**å­¦ç”Ÿçš„æŸ¥è¯¢ç»“æœ**ï¼š${JSON.stringify(userResult.rows)}`
    }
  ];

  return this.callQwenAPI(messages, 1500, 'coder');
}
```

#### 7.3.3 æ™ºèƒ½è¯„è®ºå›å¤

```javascript
async generateReply(commentContent, parentContent = null) {
  const messages = [
    {
      role: 'system',
      content: `ä½ æ˜¯SQLå­¦ä¹ å¹³å°çš„AIåŠ©æ‰‹"å°Q"ã€‚ä½ çš„ä»»åŠ¡æ˜¯å›å¤ç”¨æˆ·çš„è¯„è®ºï¼Œæä¾›æœ‰å¸®åŠ©çš„SQLå­¦ä¹ å»ºè®®ã€‚
å›å¤è¦æ±‚ï¼š
1. å‹å¥½ã€ä¸“ä¸šã€é¼“åŠ±å­¦ä¹ 
2. å¦‚æœç”¨æˆ·æé—®ï¼Œç»™å‡ºæ¸…æ™°çš„è§£ç­”
3. å¦‚æœç”¨æˆ·åˆ†äº«ç»éªŒï¼Œç»™äºˆè‚¯å®šå¹¶è¡¥å……
4. é€‚å½“å¼•ç”¨SQLçŸ¥è¯†ç‚¹`
    },
    { role: 'user', content: commentContent }
  ];

  return this.callQwenAPI(messages, 1000, 'max');
}
```

### 7.4 Promptå·¥ç¨‹æŠ€å·§

æœ¬é¡¹ç›®åœ¨AIæç¤ºè¯è®¾è®¡ä¸Šé‡‡ç”¨äº†ä»¥ä¸‹æŠ€å·§ï¼š

1. **è§’è‰²è®¾å®š**ï¼šæ˜ç¡®å®šä¹‰AIçš„è§’è‰²ï¼ˆSQLæ•™å¸ˆã€ä»£ç ä¸“å®¶ï¼‰
2. **è¾“å‡ºæ ¼å¼**ï¼šæŒ‡å®šå›å¤çš„ç»“æ„ï¼ˆåˆ†ç‚¹ã€ä½¿ç”¨Markdownï¼‰
3. **è¡Œä¸ºçº¦æŸ**ï¼šé™åˆ¶AIè¡Œä¸ºï¼ˆä¸ç›´æ¥ç»™ç­”æ¡ˆï¼Œå¼•å¯¼æ€è€ƒï¼‰
4. **è¯­æ°”è¦æ±‚**ï¼šæŒ‡å®šè¯­è¨€é£æ ¼ï¼ˆå‹å¥½ã€ä¸“ä¸šã€é¼“åŠ±ï¼‰
5. **ä¸Šä¸‹æ–‡æä¾›**ï¼šæä¾›å®Œæ•´çš„é—®é¢˜èƒŒæ™¯ä¿¡æ¯

---

## 8. å®‰å…¨æœºåˆ¶

### 8.1 å¯†ç å®‰å…¨

ä½¿ç”¨ **bcryptjs** è¿›è¡Œå¯†ç å“ˆå¸Œï¼Œé‡‡ç”¨12è½®åŠ ç›ï¼š

```javascript
const bcrypt = require('bcryptjs');

// å¯†ç åŠ å¯†å­˜å‚¨
const passwordHash = await bcrypt.hash(password, 12);

// å¯†ç éªŒè¯
const isValid = await bcrypt.compare(plainPassword, hashedPassword);
```

### 8.2 JWTä»¤ç‰Œè®¤è¯

```javascript
const jwt = require('jsonwebtoken');

// ç”ŸæˆToken
const generateToken = (userId) => {
  return jwt.sign(
    { userId },
    config.jwtSecret,
    { expiresIn: '7d' }  // 7å¤©è¿‡æœŸ
  );
};

// éªŒè¯Token
const decoded = jwt.verify(token, config.jwtSecret);
```

### 8.3 SQLæ³¨å…¥é˜²æŠ¤

ä½¿ç”¨**å‚æ•°åŒ–æŸ¥è¯¢**é˜²æ­¢SQLæ³¨å…¥ï¼š

```javascript
// âœ… å®‰å…¨ï¼šå‚æ•°åŒ–æŸ¥è¯¢
const sql = 'SELECT * FROM users WHERE email = $1';
const result = await query(sql, [email]);

// âŒ å±é™©ï¼šå­—ç¬¦ä¸²æ‹¼æ¥
const sql = `SELECT * FROM users WHERE email = '${email}'`;
```

### 8.4 SQLæ‰§è¡Œå®‰å…¨æ²™ç®±

ä¾‹é¢˜æ¨¡å—çš„SQLæ‰§è¡Œå™¨å®ç°äº†å®‰å…¨æ²™ç®±ï¼š

```javascript
static async executeUserSQL(userSQL) {
  // åªå…è®¸SELECTè¯­å¥
  const trimmedSQL = userSQL.trim().toUpperCase();
  if (!trimmedSQL.startsWith('SELECT')) {
    return { success: false, error: 'åªå…è®¸æ‰§è¡Œ SELECT æŸ¥è¯¢è¯­å¥' };
  }

  // æ£€æŸ¥å±é™©å…³é”®å­—
  const dangerousKeywords = ['DROP', 'DELETE', 'UPDATE', 'INSERT', 'ALTER', 'TRUNCATE', 'CREATE'];
  for (const keyword of dangerousKeywords) {
    if (trimmedSQL.includes(keyword)) {
      return { success: false, error: `ä¸å…è®¸ä½¿ç”¨ ${keyword} æ“ä½œ` };
    }
  }

  // å®‰å…¨æ‰§è¡Œ
  return await query(userSQL);
}
```

### 8.5 HTTPå®‰å…¨å¤´

ä½¿ç”¨ **Helmet** ä¸­é—´ä»¶è®¾ç½®å®‰å…¨HTTPå¤´ï¼š

```javascript
app.use(helmet({
  contentSecurityPolicy: true,           // CSPç­–ç•¥
  crossOriginEmbedderPolicy: true,       // è·¨åŸŸåµŒå…¥ç­–ç•¥
  crossOriginOpenerPolicy: true,         // è·¨åŸŸæ‰“å¼€ç­–ç•¥
  crossOriginResourcePolicy: { policy: "cross-origin" },
  dnsPrefetchControl: true,              // DNSé¢„å–æ§åˆ¶
  frameguard: true,                      // ç‚¹å‡»åŠ«æŒé˜²æŠ¤
  hidePoweredBy: true,                   // éšè—X-Powered-By
  hsts: true,                            // å¼ºåˆ¶HTTPS
  xssFilter: true                        // XSSè¿‡æ»¤
}));
```

### 8.6 è¯·æ±‚é¢‘ç‡é™åˆ¶

```javascript
// å…¨å±€é™åˆ¶
const limiter = rateLimit({
  windowMs: 15 * 60 * 1000,  // 15åˆ†é’Ÿ
  max: 100                    // æœ€å¤š100æ¬¡
});

// AIæ¥å£æ›´ä¸¥æ ¼é™åˆ¶
const aiLimiter = rateLimit({
  windowMs: 60 * 1000,        // 1åˆ†é’Ÿ
  max: 10                     // æœ€å¤š10æ¬¡
});
```

---

## 9. éƒ¨ç½²æ¶æ„

### 9.1 éƒ¨ç½²æ–¹æ¡ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·è®¿é—®                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                               â”‚
          â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Netlify/Vercel    â”‚       â”‚      Render         â”‚
â”‚   (å‰ç«¯é™æ€æ‰˜ç®¡)     â”‚       â”‚   (åç«¯Node.js)     â”‚
â”‚   Vue 3 SPA         â”‚       â”‚   Express API       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                             â”‚
          â”‚         APIè¯·æ±‚              â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                               â”‚
          â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      NeonDB         â”‚       â”‚    é˜¿é‡Œäº‘é€šä¹‰åƒé—®    â”‚
â”‚  PostgreSQLäº‘æ•°æ®åº“  â”‚       â”‚    å¤§æ¨¡å‹API        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 ç¯å¢ƒå˜é‡é…ç½®

```bash
# æ•°æ®åº“
DATABASE_URL=postgresql://user:pass@host/db?sslmode=require

# JWT
JWT_SECRET=your-secret-key
JWT_EXPIRES_IN=7d

# AIæ¨¡å‹
QWEN_API_KEY=sk-xxxxxxxxxxxxx
QWEN_API_URL=https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions
QWEN_CODER_MODEL=qwen3-coder-plus
QWEN_MAX_MODEL=qwen-max

# æœåŠ¡å™¨
PORT=3000
NODE_ENV=production
```

### 9.3 Viteæ„å»ºé…ç½®

```javascript
// vite.config.js
export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: { '@': '/src' }
  },
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:3000',
        changeOrigin: true
      }
    }
  },
  build: {
    outDir: 'dist',
    sourcemap: false,
    minify: 'terser'
  }
})
```

---

## 10. æ ¸å¿ƒåŠŸèƒ½å®ç°åŸç†

### 10.1 ç”¨æˆ·è®¤è¯æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·   â”‚â”€â”€â”€â”€â–ºâ”‚  å‰ç«¯   â”‚â”€â”€â”€â”€â–ºâ”‚  åç«¯   â”‚â”€â”€â”€â”€â–ºâ”‚ æ•°æ®åº“  â”‚
â”‚         â”‚     â”‚         â”‚     â”‚         â”‚     â”‚         â”‚
â”‚ è¾“å…¥è´¦å¯† â”‚     â”‚ å‘é€è¯·æ±‚ â”‚     â”‚ éªŒè¯å¯†ç  â”‚     â”‚ æŸ¥è¯¢ç”¨æˆ· â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ ç”ŸæˆJWT Token     â”‚
                          â”‚ è¿”å›ç”¨æˆ·ä¿¡æ¯       â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ å‰ç«¯å­˜å‚¨Token     â”‚
                          â”‚ localStorage      â”‚
                          â”‚ åç»­è¯·æ±‚æºå¸¦Token â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 ä¾‹é¢˜ç­”æ¡ˆéªŒè¯æµç¨‹

```
ç”¨æˆ·æäº¤SQL
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å®‰å…¨æ£€æŸ¥       â”‚
â”‚   - æ˜¯å¦ä¸ºSELECT  â”‚
â”‚   - å±é™©å…³é”®å­—    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æ‰§è¡Œç”¨æˆ·SQL    â”‚
â”‚   è·å–æŸ¥è¯¢ç»“æœ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æ‰§è¡Œæ­£ç¡®ç­”æ¡ˆ   â”‚
â”‚   è·å–é¢„æœŸç»“æœ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æ¯”è¾ƒç»“æœé›†     â”‚
â”‚   è§„èŒƒåŒ–æ¯”è¾ƒ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
     â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
     â”‚         â”‚
     â–¼         â–¼
  æ­£ç¡®       é”™è¯¯
     â”‚         â”‚
     â”‚         â–¼
     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚    â”‚ 5. è°ƒç”¨AIåˆ†æ â”‚
     â”‚    â”‚   ç”Ÿæˆå¼•å¯¼åé¦ˆ â”‚
     â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚            â”‚
     â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ä¿å­˜ç­”é¢˜è®°å½•   â”‚
â”‚   è¿”å›ç»“æœç»™ç”¨æˆ·   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.3 ç»“æœé›†æ¯”è¾ƒç®—æ³•

```javascript
static compareResultSets(userRows, correctRows) {
  // è¡Œæ•°ä¸åŒï¼Œç›´æ¥è¿”å›false
  if (userRows.length !== correctRows.length) {
    return false;
  }

  // è§„èŒƒåŒ–æ¯ä¸€è¡Œæ•°æ®
  const normalizeRow = (row) => {
    const values = Object.values(row).map(v => 
      v === null ? 'NULL' : String(v).trim()
    );
    return values.sort().join('|');  // æ’åºåæ‹¼æ¥
  };

  // è½¬ä¸ºSetè¿›è¡Œæ— åºæ¯”è¾ƒ
  const userSet = new Set(userRows.map(normalizeRow));
  const correctSet = new Set(correctRows.map(normalizeRow));

  // æ¯”è¾ƒä¸¤ä¸ªSet
  for (const item of userSet) {
    if (!correctSet.has(item)) {
      return false;
    }
  }

  return true;
}
```

---

## 11. æŠ€æœ¯äº®ç‚¹ä¸åˆ›æ–°

### 11.1 åˆ›æ–°ç‚¹æ€»ç»“

| åˆ›æ–°ç‚¹ | æè¿° |
|--------|------|
| **AIå¼•å¯¼å¼æ•™å­¦** | ä¸ç›´æ¥ç»™å‡ºç­”æ¡ˆï¼Œè€Œæ˜¯é€šè¿‡AIå¼•å¯¼å­¦ç”Ÿæ€è€ƒï¼Œç¬¦åˆæ•™è‚²ç†å¿µ |
| **åŒæ¨¡å‹ç­–ç•¥** | ä»£ç ä»»åŠ¡ç”¨ä¸“ä¸šä»£ç æ¨¡å‹ï¼Œå¯¹è¯ç”¨é€šç”¨æ¨¡å‹ï¼Œæ•ˆæœæ›´ä½³ |
| **å®‰å…¨SQLæ²™ç®±** | å­¦ç”Ÿå¯ä»¥è‡ªç”±ç»ƒä¹ SQLï¼ŒåŒæ—¶ä¿è¯ç³»ç»Ÿå®‰å…¨ |
| **å®æ—¶ç­”æ¡ˆéªŒè¯** | è‡ªåŠ¨æ¯”å¯¹æŸ¥è¯¢ç»“æœï¼Œå³æ—¶åé¦ˆå­¦ä¹ æ•ˆæœ |
| **åŠ¨æ€èƒŒæ™¯æ•ˆæœ** | Canvasç²’å­åŠ¨ç”»ï¼Œæå‡ç”¨æˆ·ä½“éªŒ |
| **è¿›åº¦è¿½è¸ª** | è®°å½•å­¦ä¹ è½¨è¿¹ï¼Œæ”¯æŒä¸ªæ€§åŒ–å­¦ä¹  |

### 11.2 æŠ€æœ¯ä¼˜åŠ¿

1. **ç°ä»£åŒ–æŠ€æœ¯æ ˆ**ï¼šVue 3 + Vite + Piniaï¼Œä»£è¡¨å‰ç«¯æœ€æ–°æŠ€æœ¯æ–¹å‘
2. **äº‘åŸç”Ÿæ¶æ„**ï¼šæ•°æ®åº“ã€AIæœåŠ¡ã€éƒ¨ç½²å…¨éƒ¨é‡‡ç”¨äº‘æœåŠ¡
3. **å®‰å…¨è®¾è®¡**ï¼šJWTè®¤è¯ã€bcryptåŠ å¯†ã€SQLæ³¨å…¥é˜²æŠ¤ã€è¯·æ±‚é™æµ
4. **å¯æ‰©å±•æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ·»åŠ æ–°åŠŸèƒ½
5. **ç”¨æˆ·ä½“éªŒ**ï¼šå“åº”å¼è®¾è®¡ã€åŠ¨æ€æ•ˆæœã€å³æ—¶åé¦ˆ

### 11.3 æ€§èƒ½ä¼˜åŒ–æªæ–½

1. **è·¯ç”±æ‡’åŠ è½½**ï¼šæŒ‰éœ€åŠ è½½é¡µé¢ç»„ä»¶
2. **æ•°æ®åº“è¿æ¥æ± **ï¼šå¤ç”¨è¿æ¥ï¼Œå‡å°‘å¼€é”€
3. **è¯·æ±‚é™æµ**ï¼šé˜²æ­¢èµ„æºæ»¥ç”¨
4. **é™æ€èµ„æºCDN**ï¼šNetlify/Vercelè‡ªå¸¦CDNåŠ é€Ÿ

---

## é™„å½•

### A. é¡¹ç›®ç›®å½•ç»“æ„

```
sql-learning-platform/
â”œâ”€â”€ backend/                    # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ config/            # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ database.js    # æ•°æ®åº“é…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ env.js         # ç¯å¢ƒå˜é‡
â”‚   â”‚   â”œâ”€â”€ controllers/       # æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ authController.js
â”‚   â”‚   â”‚   â”œâ”€â”€ exerciseController.js
â”‚   â”‚   â”‚   â”œâ”€â”€ commentController.js
â”‚   â”‚   â”‚   â””â”€â”€ aiController.js
â”‚   â”‚   â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ User.js
â”‚   â”‚   â”‚   â”œâ”€â”€ Exercise.js
â”‚   â”‚   â”‚   â””â”€â”€ Comment.js
â”‚   â”‚   â”œâ”€â”€ routes/            # è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ middleware/        # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ services/          # æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ aiService.js   # AIæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ scripts/           # è„šæœ¬
â”‚   â”‚   â””â”€â”€ app.js             # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ .env                   # ç¯å¢ƒå˜é‡
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ frontend/                   # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ views/             # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ components/        # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ stores/            # PiniaçŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ services/          # APIæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ router/            # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ assets/            # é™æ€èµ„æº
â”‚   â”‚   â””â”€â”€ main.js            # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ public/                # å…¬å…±èµ„æº
â”‚   â”œâ”€â”€ vite.config.js         # Viteé…ç½®
â”‚   â””â”€â”€ package.json
â””â”€â”€ README.md
```

### B. APIæ¥å£æ–‡æ¡£æ‘˜è¦

| æ¨¡å— | æ¥å£ | æ–¹æ³• | æè¿° |
|------|------|------|------|
| è®¤è¯ | `/api/auth/register` | POST | ç”¨æˆ·æ³¨å†Œ |
| è®¤è¯ | `/api/auth/login` | POST | ç”¨æˆ·ç™»å½• |
| è®¤è¯ | `/api/auth/profile` | GET | è·å–ä¸ªäººä¿¡æ¯ |
| ä¾‹é¢˜ | `/api/exercises` | GET | è·å–ä¾‹é¢˜åˆ—è¡¨ |
| ä¾‹é¢˜ | `/api/exercises/:id` | GET | è·å–ä¾‹é¢˜è¯¦æƒ… |
| ä¾‹é¢˜ | `/api/exercises/execute` | POST | æ‰§è¡ŒSQL |
| ä¾‹é¢˜ | `/api/exercises/:id/submit` | POST | æäº¤ç­”æ¡ˆ |
| AI | `/api/ai/analyze` | POST | ä»£ç åˆ†æ |
| AI | `/api/ai/ask` | POST | é—®ç­” |
| è¯„è®º | `/api/comments` | GET/POST | è¯„è®ºå¢åˆ æ”¹æŸ¥ |

---

**æŠ¥å‘Šæ’°å†™æ—¥æœŸ**ï¼š2025å¹´12æœˆ  
**æŠ€æœ¯æ”¯æŒ**ï¼šå“ˆå°”æ»¨å‰‘æ¡¥å­¦é™¢

